/*
 * Simplify.js, a high-performance JS polyline simplification library.
 * https://mourner.github.io/simplify-js
 * BSD License
 * Copyright (c) 2017, Vladimir Agafonkin
 */
export const simplify = (function(){"use strict";function n(n,r){var t=n[0]-r[0],u=n[1]-r[1];return t*t+u*u}function r(n,r,t){var u=r[0],i=r[1],f=t[0]-u,o=t[1]-i;if(0!==f||0!==o){var e=((n[0]-u)*f+(n[1]-i)*o)/(f*f+o*o);e>1?(u=t[0],i=t[1]):e>0&&(u+=f*e,i+=o*e)}return f=n[0]-u,o=n[1]-i,f*f+o*o}function t(r,t){for(var u,i=r[0],f=[i],o=1,e=r.length;e>o;o++)u=r[o],n(u,i)>t&&(f.push(u),i=u);return i!==u&&f.push(u),f}function u(n,t,i,f,o){for(var e,v=f,a=t+1;i>a;a++){var c=r(n[a],n[t],n[i]);c>v&&(e=a,v=c)}v>f&&(e-t>1&&u(n,t,e,f,o),o.push(n[e]),i-e>1&&u(n,e,i,f,o))}function i(n,r){var t=n.length-1,i=[n[0]];return u(n,0,t,r,i),i.push(n[t]),i}function f(n,r,u){if(n.length<=2)return n;var f=void 0!==r?r*r:1;return n=u?n:t(n,f),n=i(n,f)}return f})();


/*
 * KDBush, a very fast static spatial index for 2D points based on a flat KD-tree.
 * https://github.com/mourner/kdbush
 * ISC License
 * Copyright (c) 2018, Vladimir Agafonkin
 */
export const KDBush = (function(){"use strict";const t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class r{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,e]=new Uint8Array(n,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const i=e>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const o=t[15&e];if(!o)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(n,2,1),[a]=new Uint32Array(n,4,1);return new r(a,h,o,n)}constructor(r,n=64,s=Float64Array,e){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const i=t.indexOf(this.ArrayType),o=2*r*this.ArrayType.BYTES_PER_ELEMENT,h=r*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-h%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${s}.`);e&&e instanceof ArrayBuffer?(this.data=e,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+h+a,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+o+h+a),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+h+a,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=r)}add(t,r){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=r,n}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return n(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:e,coords:i,nodeSize:o}=this,h=[0,e.length-1,0],a=[];for(;h.length;){const d=h.pop()||0,f=h.pop()||0,p=h.pop()||0;if(f-p<=o){for(let o=p;o<=f;o++){const h=i[2*o],d=i[2*o+1];h>=t&&h<=n&&d>=r&&d<=s&&a.push(e[o])}continue}const c=p+f>>1,u=i[2*c],y=i[2*c+1];u>=t&&u<=n&&y>=r&&y<=s&&a.push(e[c]),(0===d?t<=u:r<=y)&&(h.push(p),h.push(c-1),h.push(1-d)),(0===d?n>=u:s>=y)&&(h.push(c+1),h.push(f),h.push(1-d))}return a}within(t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:e,nodeSize:i}=this,h=[0,s.length-1,0],a=[],d=n*n;for(;h.length;){const f=h.pop()||0,p=h.pop()||0,c=h.pop()||0;if(p-c<=i){for(let n=c;n<=p;n++)o(e[2*n],e[2*n+1],t,r)<=d&&a.push(s[n]);continue}const u=c+p>>1,y=e[2*u],w=e[2*u+1];o(y,w,t,r)<=d&&a.push(s[u]),(0===f?t-n<=y:r-n<=w)&&(h.push(c),h.push(u-1),h.push(1-f)),(0===f?t+n>=y:r+n>=w)&&(h.push(u+1),h.push(p),h.push(1-f))}return a}}function n(t,r,e,i,o,h){if(o-i<=e)return;const a=i+o>>1;s(t,r,a,i,o,h),n(t,r,e,i,a-1,1-h),n(t,r,e,a+1,o,1-h)}function s(t,r,n,i,o,h){for(;o>i;){if(o-i>600){const e=o-i+1,a=n-i+1,d=Math.log(e),f=.5*Math.exp(2*d/3),p=.5*Math.sqrt(d*f*(e-f)/e)*(a-e/2<0?-1:1);s(t,r,n,Math.max(i,Math.floor(n-a*f/e+p)),Math.min(o,Math.floor(n+(e-a)*f/e+p)),h)}const a=r[2*n+h];let d=i,f=o;for(e(t,r,i,n),r[2*o+h]>a&&e(t,r,i,o);d<f;){for(e(t,r,d,f),d++,f--;r[2*d+h]<a;)d++;for(;r[2*f+h]>a;)f--}r[2*i+h]===a?e(t,r,i,f):(f++,e(t,r,f,o)),f<=n&&(i=f+1),n<=f&&(o=f-1)}}function e(t,r,n,s){i(t,n,s),i(r,2*n,2*s),i(r,2*n+1,2*s+1)}function i(t,r,n){const s=t[r];t[r]=t[n],t[n]=s}function o(t,r,n,s){const e=t-n,i=r-s;return e*e+i*i}return r})();


/*
 * Flatbush, a really fast static spatial index for 2D points and rectangles in JavaScript.
 * https://github.com/mourner/flatbush
 * ISC License
 * Copyright (c) 2022, Vladimir Agafonkin
 */
export const Flatbush=(function(){
    class t{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,s){let i=this.length++;for(;i>0;){const t=i-1>>1,e=this.values[t];if(s>=e)break;this.ids[i]=this.ids[t],this.values[i]=e,i=t}this.ids[i]=t,this.values[i]=s}pop(){if(0===this.length)return;const t=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],s=this.values[0]=this.values[this.length],i=this.length>>1;let e=0;for(;e<i;){let t=1+(e<<1);const i=t+1;let h=this.ids[t],n=this.values[t];const r=this.values[i];if(i<this.length&&r<n&&(t=i,h=this.ids[i],n=r),n>=s)break;this.ids[e]=h,this.values[e]=n,e=t}this.ids[e]=t,this.values[e]=s}return t}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}
    const s=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];
    class i{static from(t,e=0){if(e%8!=0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||void 0===t.byteLength||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[h,n]=new Uint8Array(t,e+0,2);if(251!==h)throw new Error("Data does not appear to be in a Flatbush format.");const r=n>>4;if(3!==r)throw new Error(`Got v${r} data when expected v3.`);const o=s[15&n];if(!o)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(t,e+2,1),[l]=new Uint32Array(t,e+4,1);return new i(l,a,o,void 0,t,e)}constructor(i,e=16,h=Float64Array,n=ArrayBuffer,r,o=0){if(void 0===i)throw new Error("Missing required argument: numItems.");if(isNaN(i)||i<=0)throw new Error(`Unexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+e,2),65535),this.byteOffset=o;let a=i,l=a;this._levelBounds=[4*a];do{a=Math.ceil(a/this.nodeSize),l+=a,this._levelBounds.push(4*l)}while(1!==a);this.ArrayType=h,this.IndexArrayType=l<16384?Uint16Array:Uint32Array;const d=s.indexOf(this.ArrayType),u=4*l*this.ArrayType.BYTES_PER_ELEMENT;if(d<0)throw new Error(`Unexpected typed array class: ${h}.`);r&&void 0!==r.byteLength&&!r.buffer?(this.data=r,this._boxes=new this.ArrayType(this.data,o+8,4*l),this._indices=new this.IndexArrayType(this.data,o+8+u,l),this._pos=4*l,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new n(8+u+l*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*l),this._indices=new this.IndexArrayType(this.data,8+u,l),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+d]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=i),this._queue=new t}add(t,s,i=t,e=s){const h=this._pos>>2,n=this._boxes;return this._indices[h]=h,n[this._pos++]=t,n[this._pos++]=s,n[this._pos++]=i,n[this._pos++]=e,t<this.minX&&(this.minX=t),s<this.minY&&(this.minY=s),i>this.maxX&&(this.maxX=i),e>this.maxY&&(this.maxY=e),h}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize)return t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,void(t[this._pos++]=this.maxY);const s=this.maxX-this.minX||1,i=this.maxY-this.minY||1,e=new Uint32Array(this.numItems);for(let h=0,n=0;h<this.numItems;h++){const r=t[n++],a=t[n++],l=t[n++],d=t[n++],u=Math.floor(65535*((r+l)/2-this.minX)/s),f=Math.floor(65535*((a+d)/2-this.minY)/i);e[h]=o(u,f)}n(e,t,this._indices,0,this.numItems-1,this.nodeSize);for(let s=0,i=0;s<this._levelBounds.length-1;s++){const e=this._levelBounds[s];for(;i<e;){const s=i;let h=t[i++],n=t[i++],r=t[i++],o=t[i++];for(let s=1;s<this.nodeSize&&i<e;s++)h=Math.min(h,t[i++]),n=Math.min(n,t[i++]),r=Math.max(r,t[i++]),o=Math.max(o,t[i++]);this._indices[this._pos>>2]=s,t[this._pos++]=h,t[this._pos++]=n,t[this._pos++]=r,t[this._pos++]=o}}}search(t,s,i,e,n){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let r=this._boxes.length-4;const o=[],a=[];for(;void 0!==r;){const l=Math.min(r+4*this.nodeSize,h(r,this._levelBounds));for(let h=r;h<l;h+=4){if(i<this._boxes[h])continue;if(e<this._boxes[h+1])continue;if(t>this._boxes[h+2])continue;if(s>this._boxes[h+3])continue;const l=0|this._indices[h>>2];r>=4*this.numItems?o.push(l):(void 0===n||n(l))&&a.push(l)}r=o.pop()}return a}neighbors(t,s,i=1/0,n=1/0,r){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const a=this._queue,l=[],d=n*n;t:for(;void 0!==o;){const n=Math.min(o+4*this.nodeSize,h(o,this._levelBounds));for(let i=o;i<n;i+=4){const h=0|this._indices[i>>2],n=e(t,this._boxes[i],this._boxes[i+2]),l=e(s,this._boxes[i+1],this._boxes[i+3]),u=n*n+l*l;u>d||(o>=4*this.numItems?a.push(h<<1,u):(void 0===r||r(h))&&a.push(1+(h<<1),u))}for(;a.length&&1&a.peek();){if(a.peekValue()>d)break t;if(l.push(a.pop()>>1),l.length===i)break t}o=a.length?a.pop()>>1:void 0}return a.clear(),l}}
    function e(t,s,i){return t<s?s-t:t<=i?0:t-i}
    function h(t,s){let i=0,e=s.length-1;for(;i<e;){const h=i+e>>1;s[h]>t?e=h:i=h+1}return s[i]}
    function n(t,s,i,e,h,o){if(Math.floor(e/o)>=Math.floor(h/o))return;const a=t[e+h>>1];let l=e-1,d=h+1;for(;;){do{l++}while(t[l]<a);do{d--}while(t[d]>a);if(l>=d)break;r(t,s,i,l,d)}n(t,s,i,e,d,o),n(t,s,i,d+1,h,o)}
    function r(t,s,i,e,h){const n=t[e];t[e]=t[h],t[h]=n;const r=4*e,o=4*h,a=s[r],l=s[r+1],d=s[r+2],u=s[r+3];s[r]=s[o],s[r+1]=s[o+1],s[r+2]=s[o+2],s[r+3]=s[o+3],s[o]=a,s[o+1]=l,s[o+2]=d,s[o+3]=u;const f=i[e];i[e]=i[h],i[h]=f}
    function o(t,s){let i=t^s,e=65535^i,h=65535^(t|s),n=t&(65535^s),r=i|e>>1,o=i>>1^i,a=h>>1^e&n>>1^h,l=i&h>>1^n>>1^n;i=r,e=o,h=a,n=l,r=i&i>>2^e&e>>2,o=i&e>>2^e&(i^e)>>2,a^=i&h>>2^e&n>>2,l^=e&h>>2^(i^e)&n>>2,i=r,e=o,h=a,n=l,r=i&i>>4^e&e>>4,o=i&e>>4^e&(i^e)>>4,a^=i&h>>4^e&n>>4,l^=e&h>>4^(i^e)&n>>4,i=r,e=o,h=a,n=l,a^=i&h>>8^e&n>>8,l^=e&h>>8^(i^e)&n>>8,i=a^a>>1,e=l^l>>1;let d=t^s,u=e|65535^(d|i);return d=16711935&(d|d<<8),d=252645135&(d|d<<4),d=858993459&(d|d<<2),d=1431655765&(d|d<<1),u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),(u<<1|d)>>>0}
    return i;
})();